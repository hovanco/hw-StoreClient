{"ast":null,"code":"var _jsxFileName = \"/Users/mac3/Desktop/workspace/StoreClient/src/pages/product/variant-detail/index.tsx\",\n    _s = $RefreshSig$();\n\nimport { ExclamationCircleOutlined } from '@ant-design/icons';\nimport { Col, Form, message, Modal, Row, Space, Typography } from 'antd';\nimport { useForm } from 'antd/lib/form/Form';\nimport get from 'lodash/get';\nimport React, { useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useHistory, useParams } from 'react-router-dom';\nimport productApi from '../../../api/product-api';\nimport { createStock, updateStock } from '../../../api/stock-api';\nimport { uploadImagesRequest } from '../../../api/upload-api';\nimport { BackLink, InsaButton, Loading, PageTopWrapper } from '../../../components';\nimport { DefaultLayout } from '../../../layout';\nimport { storeAction } from '../../../reducers/storeState/action';\nimport { NoProduct } from '../components';\nimport { useVariant, VariantContextProvider } from './context';\nimport './index.less';\nimport VariantForm from './variant-form';\nimport VariantList from './variant-list';\nimport VariantParentAbout from './variant-parent-about';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst VariantDetail = () => {\n  _s();\n\n  const [product, setProduct] = useState();\n  const [loading, setLoading] = useState(false);\n  const {\n    data: storeObj\n  } = useSelector(state => state.store);\n  const token = useSelector(state => state.auth.token);\n  const params = useParams();\n  const history = useHistory();\n  const dispatch = useDispatch();\n  const {\n    variant,\n    image,\n    attributesToAddNew,\n    setImage,\n    setVariant,\n    addNewVariant,\n    prepareAttributesToAddNew\n  } = useVariant();\n  const [form] = useForm();\n  useEffect(() => {\n    form.setFieldsValue(variant); // eslint-disable-next-line\n  }, [variant]);\n  useEffect(() => {\n    async function loadProduct({\n      storeId,\n      productId\n    }) {\n      try {\n        setLoading(true);\n        const response = await productApi.getProduct({\n          storeId,\n          productId\n        });\n\n        if (!response.attributes) {\n          history.push(`/products/detail/${productId}`);\n        } else {\n          setProduct(response);\n        }\n      } catch (error) {} finally {\n        setLoading(false);\n      }\n    }\n\n    if (storeObj._id) {\n      loadProduct({\n        storeId: storeObj._id,\n        productId: params === null || params === void 0 ? void 0 : params.productId\n      });\n      dispatch(storeAction.getAttributes(storeObj._id));\n    } // eslint-disable-next-line\n\n  }, [storeObj._id]);\n  useEffect(() => {\n    if (product) {\n      prepareAttributesToAddNew(product.attributes || []);\n\n      if (params.variantId !== 'new') {\n        var _product$variants;\n\n        let newVariants = product === null || product === void 0 ? void 0 : (_product$variants = product.variants) === null || _product$variants === void 0 ? void 0 : _product$variants.filter(item => item._id === params.variantId);\n\n        if (newVariants === null || newVariants === void 0 ? void 0 : newVariants.length) {\n          setVariant(newVariants[0]);\n        } else {\n          var _product$variants2, _product$variants3, _product$variants3$;\n\n          setVariant(product === null || product === void 0 ? void 0 : (_product$variants2 = product.variants) === null || _product$variants2 === void 0 ? void 0 : _product$variants2[0]);\n          history.replace(`/products/detail/${product._id}/variant/${product === null || product === void 0 ? void 0 : (_product$variants3 = product.variants) === null || _product$variants3 === void 0 ? void 0 : (_product$variants3$ = _product$variants3[0]) === null || _product$variants3$ === void 0 ? void 0 : _product$variants3$._id}`);\n        }\n      }\n    } // eslint-disable-next-line\n\n  }, [product]);\n  useEffect(() => {\n    if (params.variantId === 'new') {\n      addNewVariant();\n    } // eslint-disable-next-line\n\n  }, [attributesToAddNew]);\n\n  const changeSelectedVariant = selectedVariant => {\n    setImage(undefined);\n    setVariant(selectedVariant);\n    history.push(`/products/detail/${product === null || product === void 0 ? void 0 : product._id}/variant/${selectedVariant._id}`);\n  };\n\n  const createVariant = async (formData, images) => {\n    try {\n      const response = await productApi.createVariant(storeObj._id, params === null || params === void 0 ? void 0 : params.productId, { ...formData,\n        images\n      });\n      history.push(`/products/detail/${params === null || params === void 0 ? void 0 : params.productId}/variant/${response._id}`);\n      message.success('Tạo sản phẩm thành công');\n      const productResponse = await productApi.getProduct({\n        storeId: storeObj._id,\n        productId: params === null || params === void 0 ? void 0 : params.productId\n      });\n      setProduct(productResponse);\n    } catch (error) {\n      message.error('Tạo sản phẩm thất bại');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const updateVariant = async (formData, images) => {\n    try {\n      const response = await productApi.updateVariant(storeObj._id, params === null || params === void 0 ? void 0 : params.productId, params.variantId, { ...formData,\n        images\n      });\n      let newVariants = (product === null || product === void 0 ? void 0 : product.variants) || [];\n      newVariants = newVariants.map(v => {\n        if (v._id === response._id) return response;\n        return v;\n      });\n      setProduct({ ...product,\n        variants: newVariants\n      });\n      message.success('Cập nhật sản phẩm thành công');\n      const updatedStock = form.getFieldValue('stocks');\n      return Promise.all(updatedStock.map(item => {\n        if (item._id === item.warehouseId) return createStock({\n          storeId: storeObj._id,\n          productId: item.productId,\n          warehouseId: item.warehouseId,\n          quantity: item.quantity\n        });\n        return updateStock({\n          storeId: storeObj._id,\n          stockId: item._id,\n          quantity: item.quantity\n        });\n      }));\n    } catch (error) {\n      message.error('Cập nhật sản phẩm thất bại');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const uploadImages = new Promise(async (resolve, reject) => {\n    if (!image) {\n      if (get(variant, 'images', []).length > 0) {\n        return resolve(variant.images.map(key => ({\n          key\n        })));\n      }\n\n      return resolve([]);\n    }\n\n    const accessToken = get(token, 'accessToken');\n    const files = [image.originFileObj];\n    uploadImagesRequest({\n      token: accessToken,\n      storeId: storeObj._id,\n      files\n    }).then(res => resolve(res)).catch(error => {\n      resolve([]);\n    }).finally(() => {\n      setLoading(false);\n    });\n  });\n\n  const saveVariant = async () => {\n    let formData = await form.validateFields();\n    setLoading(true);\n    uploadImages.then(async response => {\n      const images = response.map(item => item.key);\n\n      if (params.variantId === 'new') {\n        await createVariant(formData, images);\n        setLoading(false);\n      } else {\n        await updateVariant(formData, images);\n      }\n    }).catch(async error => {\n      if (params.variantId === 'new') {\n        await createVariant(formData);\n      } else {\n        await updateVariant(formData);\n      }\n    });\n  };\n\n  const confirmDeleteVariant = () => {\n    Modal.confirm({\n      title: 'Bạn chắc chắn muốn xoá sản phẩm này?',\n      icon: /*#__PURE__*/_jsxDEV(ExclamationCircleOutlined, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 19\n      }, this),\n      onOk: async () => {\n        await removeVariant();\n      },\n\n      onCancel() {}\n\n    });\n  };\n\n  const removeVariant = async () => {\n    try {\n      setLoading(true);\n      let responseStatus = await productApi.deleteVariant(storeObj._id, params === null || params === void 0 ? void 0 : params.productId, params.variantId);\n\n      if (responseStatus === 200) {\n        message.success('Xoá phiên bản thành công');\n        let newVariants = (product === null || product === void 0 ? void 0 : product.variants) || [];\n        newVariants = newVariants.filter(v => v._id !== params.variantId);\n        if (newVariants.length) history.push(`/products/detail/${params === null || params === void 0 ? void 0 : params.productId}/variant/${newVariants[0]._id}`);else history.push(`/products/detail/${params === null || params === void 0 ? void 0 : params.productId}/variant/new`);\n        setProduct({ ...product,\n          variants: newVariants\n        });\n      } else {\n        message.error('Xoá phiên bản thất bại');\n      }\n    } catch (error) {\n      message.error('Xoá phiên bản thất bại');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (loading) return /*#__PURE__*/_jsxDEV(Loading, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 286,\n    columnNumber: 25\n  }, this);\n\n  if (!product) {\n    return /*#__PURE__*/_jsxDEV(NoProduct, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 16\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(DefaultLayout, {\n    title: product.name + ' ' + variant.attributes.map(i => i.tags).join(' - '),\n    children: [/*#__PURE__*/_jsxDEV(PageTopWrapper, {\n      leftContent: /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(BackLink, {\n          to: `/products/detail/${product === null || product === void 0 ? void 0 : product._id}`,\n          text: \" Chi ti\\u1EBFt s\\u1EA3n ph\\u1EA9m\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 301,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(Typography.Title, {\n          level: 3,\n          children: variant.attributes.length ? /*#__PURE__*/_jsxDEV(\"span\", {\n            children: [product.name, ' ', variant.attributes.map(i => i.tags).join(' - ')]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 304,\n            columnNumber: 33\n          }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 302,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true),\n      rightContent: /*#__PURE__*/_jsxDEV(Space, {\n        children: [/*#__PURE__*/_jsxDEV(InsaButton, {\n          style: {\n            width: 140\n          },\n          onClick: () => history.push(`/products/detail/${product === null || product === void 0 ? void 0 : product._id}`),\n          children: \"Hu\\u1EF7\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 316,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(InsaButton, {\n          type: \"primary\",\n          style: {\n            width: 140\n          },\n          onClick: saveVariant,\n          children: params.variantId !== 'new' ? 'Cập nhật' : 'Tạo phiên bản'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 315,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 298,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Row, {\n      gutter: 16,\n      className: \"variant-detail\",\n      children: [/*#__PURE__*/_jsxDEV(Col, {\n        span: 8,\n        children: [/*#__PURE__*/_jsxDEV(VariantParentAbout, {\n          product: product\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 335,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(VariantList, {\n          product: product,\n          onChangeSelectedVariant: changeSelectedVariant\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 336,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 334,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Col, {\n        span: 16,\n        children: /*#__PURE__*/_jsxDEV(Form, {\n          layout: \"vertical\",\n          className: \"variant-form\",\n          size: \"small\",\n          form: form,\n          children: /*#__PURE__*/_jsxDEV(VariantForm, {\n            form: form\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 343,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 342,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 341,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 333,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Row, {\n      className: \"variant-detail\",\n      justify: \"end\",\n      children: /*#__PURE__*/_jsxDEV(Col, {\n        children: /*#__PURE__*/_jsxDEV(Space, {\n          style: {\n            width: '100%',\n            justifyContent: 'flex-end'\n          },\n          children: [params.variantId !== 'new' && /*#__PURE__*/_jsxDEV(InsaButton, {\n            style: {\n              width: 140\n            },\n            onClick: confirmDeleteVariant,\n            type: \"primary\",\n            danger: true,\n            children: \"Xo\\xE1 phi\\xEAn b\\u1EA3n\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 352,\n            columnNumber: 29\n          }, this), /*#__PURE__*/_jsxDEV(InsaButton, {\n            type: \"primary\",\n            style: {\n              width: 140\n            },\n            onClick: saveVariant,\n            children: params.variantId !== 'new' ? 'Cập nhật' : 'Tạo phiên bản'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 361,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 350,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 349,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 348,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 293,\n    columnNumber: 9\n  }, this);\n};\n\n_s(VariantDetail, \"CDepZqioSnPEh3mCHmiQr0qqGvg=\", false, function () {\n  return [useSelector, useSelector, useParams, useHistory, useDispatch, useVariant, useForm];\n});\n\n_c = VariantDetail;\n\nconst VariantDetailWithProvider = () => /*#__PURE__*/_jsxDEV(VariantContextProvider, {\n  children: /*#__PURE__*/_jsxDEV(VariantDetail, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 377,\n    columnNumber: 9\n  }, this)\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 376,\n  columnNumber: 5\n}, this);\n\n_c2 = VariantDetailWithProvider;\nexport default VariantDetailWithProvider;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"VariantDetail\");\n$RefreshReg$(_c2, \"VariantDetailWithProvider\");","map":{"version":3,"sources":["/Users/mac3/Desktop/workspace/StoreClient/src/pages/product/variant-detail/index.tsx"],"names":["ExclamationCircleOutlined","Col","Form","message","Modal","Row","Space","Typography","useForm","get","React","useEffect","useState","useDispatch","useSelector","useHistory","useParams","productApi","createStock","updateStock","uploadImagesRequest","BackLink","InsaButton","Loading","PageTopWrapper","DefaultLayout","storeAction","NoProduct","useVariant","VariantContextProvider","VariantForm","VariantList","VariantParentAbout","VariantDetail","product","setProduct","loading","setLoading","data","storeObj","state","store","token","auth","params","history","dispatch","variant","image","attributesToAddNew","setImage","setVariant","addNewVariant","prepareAttributesToAddNew","form","setFieldsValue","loadProduct","storeId","productId","response","getProduct","attributes","push","error","_id","getAttributes","variantId","newVariants","variants","filter","item","length","replace","changeSelectedVariant","selectedVariant","undefined","createVariant","formData","images","success","productResponse","updateVariant","map","v","updatedStock","getFieldValue","Promise","all","warehouseId","quantity","stockId","uploadImages","resolve","reject","key","accessToken","files","originFileObj","then","res","catch","finally","saveVariant","validateFields","confirmDeleteVariant","confirm","title","icon","onOk","removeVariant","onCancel","responseStatus","deleteVariant","name","i","tags","join","width","justifyContent","VariantDetailWithProvider"],"mappings":"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","sourcesContent":["import { ExclamationCircleOutlined, QuestionCircleOutlined } from '@ant-design/icons';\nimport { Col, Form, message, Modal, Row, Space, Typography } from 'antd';\nimport { useForm } from 'antd/lib/form/Form';\nimport get from 'lodash/get';\nimport React, { FC, useEffect, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useHistory, useParams } from 'react-router-dom';\nimport productApi from '../../../api/product-api';\nimport { createStock, updateStock } from '../../../api/stock-api';\nimport { uploadImagesRequest } from '../../../api/upload-api';\nimport { BackLink, InsaButton, Loading, PageTopWrapper } from '../../../components';\nimport { DefaultLayout } from '../../../layout';\nimport { IAttribute, IProduct, IVariant, IVariantParam } from '../../../models';\nimport { storeAction } from '../../../reducers/storeState/action';\nimport { IState } from '../../../store/rootReducer';\nimport { NoProduct } from '../components';\nimport { IEditStock, IProductVariantDetailParams } from '../interface';\nimport { useVariant, VariantContextProvider } from './context';\nimport './index.less';\nimport VariantForm from './variant-form';\nimport VariantList from './variant-list';\nimport VariantParentAbout from './variant-parent-about';\n\nconst VariantDetail: FC = () => {\n    const [product, setProduct] = useState<IProduct>();\n    const [loading, setLoading] = useState<boolean>(false);\n\n    const { data: storeObj } = useSelector((state: IState) => state.store);\n    const token = useSelector((state: IState) => state.auth.token);\n\n    const params = useParams<IProductVariantDetailParams>();\n    const history = useHistory();\n    const dispatch = useDispatch();\n\n    const {\n        variant,\n        image,\n        attributesToAddNew,\n        setImage,\n        setVariant,\n        addNewVariant,\n        prepareAttributesToAddNew,\n    } = useVariant();\n\n    const [form] = useForm();\n\n    useEffect(() => {\n        form.setFieldsValue(variant);\n        // eslint-disable-next-line\n    }, [variant]);\n\n    useEffect(() => {\n        async function loadProduct({ storeId, productId }: { storeId: string; productId: string }) {\n            try {\n                setLoading(true);\n                const response = await productApi.getProduct({\n                    storeId,\n                    productId,\n                });\n\n                if (!response.attributes) {\n                    history.push(`/products/detail/${productId}`);\n                } else {\n                    setProduct(response);\n                }\n            } catch (error) {\n            } finally {\n                setLoading(false);\n            }\n        }\n\n        if (storeObj._id) {\n            loadProduct({\n                storeId: storeObj._id,\n                productId: params?.productId as string,\n            });\n            dispatch(storeAction.getAttributes(storeObj._id));\n        }\n        // eslint-disable-next-line\n    }, [storeObj._id]);\n\n    useEffect(() => {\n        if (product) {\n            prepareAttributesToAddNew(product.attributes || []);\n\n            if (params.variantId !== 'new') {\n                let newVariants: IVariant[] | undefined = product?.variants?.filter(\n                    (item: IProduct) => item._id === params.variantId\n                );\n\n                if (newVariants?.length) {\n                    setVariant(newVariants[0]);\n                } else {\n                    setVariant(product?.variants?.[0]);\n                    history.replace(\n                        `/products/detail/${product._id}/variant/${product?.variants?.[0]?._id}`\n                    );\n                }\n            }\n        }\n        // eslint-disable-next-line\n    }, [product]);\n\n    useEffect(() => {\n        if (params.variantId === 'new') {\n            addNewVariant();\n        }\n        // eslint-disable-next-line\n    }, [attributesToAddNew]);\n\n    const changeSelectedVariant = (selectedVariant: IVariant) => {\n        setImage(undefined);\n        setVariant(selectedVariant);\n        history.push(`/products/detail/${product?._id}/variant/${selectedVariant._id}`);\n    };\n\n    const createVariant = async (formData: IVariantParam, images?: string[]) => {\n        try {\n            const response = await productApi.createVariant(\n                storeObj._id as string,\n                params?.productId as string,\n                {\n                    ...(formData as IVariant),\n                    images,\n                }\n            );\n\n            history.push(`/products/detail/${params?.productId}/variant/${response._id}`);\n\n            message.success('Tạo sản phẩm thành công');\n\n            const productResponse = await productApi.getProduct({\n                storeId: storeObj._id as string,\n                productId: params?.productId as string,\n            });\n\n            setProduct(productResponse);\n        } catch (error) {\n            message.error('Tạo sản phẩm thất bại');\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const updateVariant = async (formData: IVariantParam, images?: string[]) => {\n        try {\n            const response = await productApi.updateVariant(\n                storeObj._id as string,\n                params?.productId as string,\n                params.variantId as string,\n                { ...(formData as IVariant), images }\n            );\n\n            let newVariants = product?.variants || [];\n\n            newVariants = newVariants.map((v: IVariant) => {\n                if (v._id === response._id) return response;\n\n                return v;\n            });\n\n            setProduct({ ...product, variants: newVariants });\n\n            message.success('Cập nhật sản phẩm thành công');\n\n            const updatedStock = form.getFieldValue('stocks');\n\n            return Promise.all(\n                updatedStock.map((item: IEditStock) => {\n                    if (item._id === item.warehouseId)\n                        return createStock({\n                            storeId: storeObj._id as string,\n                            productId: item.productId as string,\n                            warehouseId: item.warehouseId,\n                            quantity: item.quantity,\n                        });\n\n                    return updateStock({\n                        storeId: storeObj._id as string,\n                        stockId: item._id,\n                        quantity: item.quantity,\n                    });\n                })\n            );\n        } catch (error) {\n            message.error('Cập nhật sản phẩm thất bại');\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const uploadImages = new Promise(async (resolve, reject) => {\n        if (!image) {\n            if (get(variant, 'images', []).length > 0) {\n                return resolve(variant.images.map((key: any) => ({ key })));\n            }\n            return resolve([]);\n        }\n\n        const accessToken = get(token, 'accessToken');\n\n        const files = [(image as any).originFileObj];\n\n        uploadImagesRequest({\n            token: accessToken,\n            storeId: storeObj._id as string,\n            files,\n        })\n            .then((res) => resolve(res))\n            .catch((error) => {\n                resolve([]);\n            })\n            .finally(() => {\n                setLoading(false);\n            });\n    });\n\n    const saveVariant = async () => {\n        let formData = await form.validateFields();\n\n        setLoading(true);\n\n        uploadImages\n            .then(async (response) => {\n                const images = (response as any[]).map((item: any) => item.key);\n\n                if (params.variantId === 'new') {\n                    await createVariant(formData, images);\n                    setLoading(false);\n                } else {\n                    await updateVariant(formData, images);\n                }\n            })\n            .catch(async (error) => {\n                if (params.variantId === 'new') {\n                    await createVariant(formData);\n                } else {\n                    await updateVariant(formData);\n                }\n            });\n    };\n\n    const confirmDeleteVariant = () => {\n        Modal.confirm({\n            title: 'Bạn chắc chắn muốn xoá sản phẩm này?',\n            icon: <ExclamationCircleOutlined />,\n            onOk: async () => {\n                await removeVariant();\n            },\n            onCancel() {},\n        });\n    };\n\n    const removeVariant = async () => {\n        try {\n            setLoading(true);\n\n            let responseStatus = await productApi.deleteVariant(\n                storeObj._id as string,\n                params?.productId as string,\n                params.variantId as string\n            );\n\n            if (responseStatus === 200) {\n                message.success('Xoá phiên bản thành công');\n\n                let newVariants = product?.variants || [];\n\n                newVariants = newVariants.filter((v: IVariant) => v._id !== params.variantId);\n\n                if (newVariants.length)\n                    history.push(`/products/detail/${params?.productId}/variant/${newVariants[0]._id}`);\n                else history.push(`/products/detail/${params?.productId}/variant/new`);\n\n                setProduct({ ...product, variants: newVariants });\n            } else {\n                message.error('Xoá phiên bản thất bại');\n            }\n        } catch (error) {\n            message.error('Xoá phiên bản thất bại');\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    if (loading) return <Loading />;\n\n    if (!product) {\n        return <NoProduct />;\n    }\n\n    return (\n        <DefaultLayout\n            title={\n                product.name + ' ' + variant.attributes.map((i: IAttribute) => i.tags).join(' - ')\n            }\n        >\n            <PageTopWrapper\n                leftContent={\n                    <>\n                        <BackLink to={`/products/detail/${product?._id}`} text=\" Chi tiết sản phẩm\" />\n                        <Typography.Title level={3}>\n                            {variant.attributes.length ? (\n                                <span>\n                                    {product.name}{' '}\n                                    {variant.attributes.map((i: IAttribute) => i.tags).join(' - ')}\n                                </span>\n                            ) : (\n                                <></>\n                            )}\n                        </Typography.Title>\n                    </>\n                }\n                rightContent={\n                    <Space>\n                        <InsaButton\n                            style={{ width: 140 }}\n                            onClick={() => history.push(`/products/detail/${product?._id}`)}\n                        >\n                            Huỷ\n                        </InsaButton>\n                        <InsaButton type=\"primary\" style={{ width: 140 }} onClick={saveVariant}>\n                            {params.variantId !== 'new' ? 'Cập nhật' : 'Tạo phiên bản'}\n                        </InsaButton>\n                        {/* TODO: Show after add feature */}\n                        {/* <InsaButton style={{ width: 140 }} icon={<QuestionCircleOutlined />}>\n                            Trợ giúp\n                        </InsaButton> */}\n                    </Space>\n                }\n            />\n\n            <Row gutter={16} className=\"variant-detail\">\n                <Col span={8}>\n                    <VariantParentAbout product={product} />\n                    <VariantList\n                        product={product}\n                        onChangeSelectedVariant={changeSelectedVariant}\n                    />\n                </Col>\n                <Col span={16}>\n                    <Form layout=\"vertical\" className=\"variant-form\" size=\"small\" form={form}>\n                        <VariantForm form={form} />\n                    </Form>\n                </Col>\n            </Row>\n\n            <Row className=\"variant-detail\" justify=\"end\">\n                <Col>\n                    <Space style={{ width: '100%', justifyContent: 'flex-end' }}>\n                        {params.variantId !== 'new' && (\n                            <InsaButton\n                                style={{ width: 140 }}\n                                onClick={confirmDeleteVariant}\n                                type=\"primary\"\n                                danger\n                            >\n                                Xoá phiên bản\n                            </InsaButton>\n                        )}\n                        <InsaButton type=\"primary\" style={{ width: 140 }} onClick={saveVariant}>\n                            {params.variantId !== 'new' ? 'Cập nhật' : 'Tạo phiên bản'}\n                        </InsaButton>\n                        {/* TODO: Show after add feature */}\n                        {/* <InsaButton style={{ width: 140 }} icon={<QuestionCircleOutlined />}>\n                            Trợ giúp\n                        </InsaButton> */}\n                    </Space>\n                </Col>\n            </Row>\n        </DefaultLayout>\n    );\n};\n\nconst VariantDetailWithProvider = () => (\n    <VariantContextProvider>\n        <VariantDetail />\n    </VariantContextProvider>\n);\n\nexport default VariantDetailWithProvider;\n"]},"metadata":{},"sourceType":"module"}