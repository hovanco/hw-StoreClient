{"ast":null,"code":"var _jsxFileName = \"/Users/mac3/Desktop/workspace/StoreClient/src/pages/product/product-detail/index.tsx\",\n    _s = $RefreshSig$();\n\nimport { ExclamationCircleOutlined } from '@ant-design/icons';\nimport { Col, Form, message, Modal, Row, Space, Typography } from 'antd';\nimport { useForm } from 'antd/lib/form/Form';\nimport { difference, get, omit } from 'lodash';\nimport React, { useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport { useHistory, useParams } from 'react-router-dom';\nimport productApi from '../../../api/product-api';\nimport { createStock } from '../../../api/stock-api';\nimport { uploadImagesRequest } from '../../../api/upload-api';\nimport { BackLink, InsaButton, Loading, PageTopWrapper } from '../../../components';\nimport { DefaultLayout } from '../../../layout';\nimport theme from '../../../theme';\nimport { NoProduct, ProductFormDetail, ProductFormMedia } from '../components';\nimport { ProductContextProvider } from '../context/context';\nimport ProductFormSaleInfo from '../components/product-form-sale-info';\nimport ProductFormGeneral from './product-form-general';\nimport ProductVariant from './product-variant';\nimport { ProviderProductDetail, useProductDetail } from './state/context';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst messageSucess = 'Cập nhật sản phẩm thành công';\nconst messageFailed = 'Cập nhật sản phẩm thất bại';\n\nconst ProductDetailContent = () => {\n  _s();\n\n  const {\n    product,\n    loading,\n    updateProduct,\n    setLoading,\n    loadProduct\n  } = useProductDetail();\n  const [filesImage, setFilesImage] = useState([]);\n  const token = useSelector(state => state.auth.token);\n  const storeObj = useSelector(state => state.store.data);\n  const attributes = useSelector(state => state.store.attributes);\n  const params = useParams();\n  const history = useHistory();\n  const [form] = useForm();\n\n  const handleDeleteProduct = async () => {\n    if (storeObj._id) {\n      await productApi.deleteProduct(storeObj._id, params.productId).then(() => {\n        history.push('/products/list');\n        message.success('Xoá sản phẩm thành công');\n      }).catch(() => {\n        message.error('Xoá sản phẩm thất bại');\n      });\n    } else {\n      message.error('Xoá sản phẩm thất bại');\n    }\n  };\n\n  const confirmDeleteProduct = () => {\n    Modal.confirm({\n      title: 'Xác nhận xoá sản phẩm hiện tại?',\n      icon: /*#__PURE__*/_jsxDEV(ExclamationCircleOutlined, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 60,\n        columnNumber: 19\n      }, this),\n      onOk: async () => {\n        await handleDeleteProduct();\n      },\n\n      onCancel() {}\n\n    });\n  };\n\n  const uploadImages = new Promise(async (resolve, reject) => {\n    if (filesImage.length === 0) {\n      resolve([]);\n      return;\n    }\n\n    const accessToken = get(token, 'accessToken');\n    const files = filesImage.map(i => i.originFileObj);\n    uploadImagesRequest({\n      token: accessToken,\n      storeId: storeObj._id,\n      files\n    }).then(res => resolve(res)).catch(error => {\n      resolve([]);\n    });\n  });\n\n  const updateImageProduct = (images, type) => {\n    let formData = form.getFieldsValue();\n    formData = { ...omit(formData, ['sku'])\n    };\n    formData = { ...formData,\n      images: [...images]\n    };\n    productApi.updateProduct(storeObj._id, params.productId, formData).then(response => {\n      message.success(type === 'remove' ? 'Đã xóa hình ảnh' : 'Cập nhật hình ảnh thành công');\n      updateProduct(response);\n    }).catch(() => {\n      message.error('Lỗi cập nhật hình ảnh');\n    }).finally(() => {});\n  };\n\n  const updateDataProduct = (formData, callback) => {\n    productApi.updateProduct(storeObj._id, params.productId, formData).then(async response => {\n      message.success(messageSucess);\n\n      if (callback) {\n        callback();\n      }\n\n      setFilesImage([]);\n      let stocks = form.getFieldValue('stocks');\n\n      if (stocks && stocks.length) {\n        stocks = stocks.filter(item => item.quantity);\n        await Promise.all(stocks.map(stock => {\n          let {\n            quantity,\n            warehouseId,\n            productId\n          } = stock;\n          return createStock({\n            storeId: storeObj._id,\n            warehouseId,\n            quantity,\n            productId: productId._id\n          });\n        }));\n        await loadProduct({\n          productId: product === null || product === void 0 ? void 0 : product._id,\n          storeId: storeObj._id\n        });\n      } else {\n        updateProduct(response);\n      }\n    }).catch(() => {\n      message.error(messageFailed);\n    }).finally(() => {\n      setLoading(false);\n    });\n  };\n\n  const handleCreateAttribute = async () => {\n    const formAttributes = form.getFieldValue('attributes');\n\n    if (formAttributes) {\n      const newAttributes = difference(formAttributes.map(i => i._id), attributes.data.map(i => i._id));\n\n      if (newAttributes.length) {\n        await Promise.all(newAttributes.map(attributeId => {\n          let attributeItem = formAttributes.filter(item => item._id === attributeId)[0];\n          return productApi.createAttribute(storeObj._id, attributeItem);\n        }));\n      }\n    }\n  };\n\n  const handleUpdateProduct = () => {\n    if (storeObj._id) {\n      setLoading(true);\n      let formData = form.getFieldsValue();\n      formData = { ...omit(formData, ['sku'])\n      };\n      uploadImages.then(async response => {\n        await handleCreateAttribute();\n        let variantsParam = formData.variants ? formData.variants.map(item => ({ ...omit(item, ['name', 'length', 'width', 'height', 'weight', 'localId'])\n        })) : undefined;\n        const images = response.map(item => item.key);\n        const productImages = (product === null || product === void 0 ? void 0 : product.images) || [];\n        formData = { ...formData,\n          images: [...productImages, ...images],\n          variants: variantsParam\n        };\n        updateDataProduct(formData, () => setFilesImage([]));\n      }).catch(error => {\n        updateDataProduct(formData);\n      });\n    } else {\n      message.error('Cập nhật sản phẩm thất bại');\n    }\n  };\n\n  if (loading) return /*#__PURE__*/_jsxDEV(Loading, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 225,\n    columnNumber: 25\n  }, this);\n\n  if (!product || product.isDeleted) {\n    return /*#__PURE__*/_jsxDEV(NoProduct, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 16\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(DefaultLayout, {\n    title: product.name,\n    children: [/*#__PURE__*/_jsxDEV(PageTopWrapper, {\n      leftContent: /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(BackLink, {\n          to: `/products/list${history.location.state || ''}`,\n          text: \" Danh s\\xE1ch s\\u1EA3n ph\\u1EA9m\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 236,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(Typography.Title, {\n          level: 3,\n          children: product.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 237,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true) // TODO: Show after add feature\n      // rightContent={\n      //     <Space>\n      //         <InsaButton\n      //             style={{ width: 140 }}\n      //             size=\"middle\"\n      //             key=\"help\"\n      //             disabled={loading}\n      //             icon={<QuestionCircleOutlined />}\n      //         >\n      //             Trợ giúp\n      //         </InsaButton>\n      //     </Space>\n      // }\n\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Form, {\n      layout: \"vertical\",\n      className: \"edit-product-form product-form\",\n      size: \"small\",\n      form: form,\n      initialValues: product || {},\n      onFinish: updateProduct,\n      children: [/*#__PURE__*/_jsxDEV(Row, {\n        gutter: [16, 0],\n        style: {\n          paddingLeft: theme.spacing.m,\n          paddingRight: theme.spacing.m,\n          marginTop: 28\n        },\n        children: [/*#__PURE__*/_jsxDEV(Col, {\n          span: 16,\n          children: [/*#__PURE__*/_jsxDEV(ProductFormGeneral, {\n            form: form\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 272,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(ProductFormSaleInfo, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 273,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(ProductContextProvider, {\n            form: form,\n            children: /*#__PURE__*/_jsxDEV(ProductVariant, {\n              form: form\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 275,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 274,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 271,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Col, {\n          span: 8,\n          children: [/*#__PURE__*/_jsxDEV(ProductFormMedia, {\n            images: product.images,\n            setFilesImage: setFilesImage,\n            updateImageProduct: updateImageProduct\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 279,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(ProductFormDetail, {\n            form: form\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 284,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 278,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 263,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Row, {\n        justify: \"end\",\n        style: {\n          marginTop: 32,\n          paddingRight: theme.spacing.m,\n          paddingBottom: 72\n        },\n        children: /*#__PURE__*/_jsxDEV(Space, {\n          children: [/*#__PURE__*/_jsxDEV(InsaButton, {\n            style: {\n              width: 140\n            },\n            size: \"middle\",\n            disabled: loading,\n            type: \"primary\",\n            danger: true,\n            onClick: confirmDeleteProduct,\n            children: \"Xo\\xE1 s\\u1EA3n ph\\u1EA9m\"\n          }, \"help\", false, {\n            fileName: _jsxFileName,\n            lineNumber: 297,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(InsaButton, {\n            style: {\n              width: 140\n            },\n            size: \"middle\",\n            disabled: loading,\n            type: \"primary\",\n            htmlType: \"submit\",\n            onClick: handleUpdateProduct,\n            children: \"C\\u1EADp nh\\u1EADt\"\n          }, \"help\", false, {\n            fileName: _jsxFileName,\n            lineNumber: 308,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 296,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 288,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 232,\n    columnNumber: 9\n  }, this);\n};\n\n_s(ProductDetailContent, \"/eIMUKATMm/HuRAJBworSY03Fq8=\", false, function () {\n  return [useProductDetail, useSelector, useSelector, useSelector, useParams, useHistory, useForm];\n});\n\n_c = ProductDetailContent;\n\nconst ProductDetail = () => {\n  return /*#__PURE__*/_jsxDEV(ProviderProductDetail, {\n    children: /*#__PURE__*/_jsxDEV(ProductDetailContent, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 329,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 328,\n    columnNumber: 9\n  }, this);\n};\n\n_c2 = ProductDetail;\nexport default ProductDetail;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"ProductDetailContent\");\n$RefreshReg$(_c2, \"ProductDetail\");","map":{"version":3,"sources":["/Users/mac3/Desktop/workspace/StoreClient/src/pages/product/product-detail/index.tsx"],"names":["ExclamationCircleOutlined","Col","Form","message","Modal","Row","Space","Typography","useForm","difference","get","omit","React","useState","useSelector","useHistory","useParams","productApi","createStock","uploadImagesRequest","BackLink","InsaButton","Loading","PageTopWrapper","DefaultLayout","theme","NoProduct","ProductFormDetail","ProductFormMedia","ProductContextProvider","ProductFormSaleInfo","ProductFormGeneral","ProductVariant","ProviderProductDetail","useProductDetail","messageSucess","messageFailed","ProductDetailContent","product","loading","updateProduct","setLoading","loadProduct","filesImage","setFilesImage","token","state","auth","storeObj","store","data","attributes","params","history","form","handleDeleteProduct","_id","deleteProduct","productId","then","push","success","catch","error","confirmDeleteProduct","confirm","title","icon","onOk","onCancel","uploadImages","Promise","resolve","reject","length","accessToken","files","map","i","originFileObj","storeId","res","updateImageProduct","images","type","formData","getFieldsValue","response","finally","updateDataProduct","callback","stocks","getFieldValue","filter","item","quantity","all","stock","warehouseId","handleCreateAttribute","formAttributes","newAttributes","attributeId","attributeItem","createAttribute","handleUpdateProduct","variantsParam","variants","undefined","key","productImages","isDeleted","name","location","paddingLeft","spacing","m","paddingRight","marginTop","paddingBottom","width","ProductDetail"],"mappings":"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","sourcesContent":["import { ExclamationCircleOutlined } from '@ant-design/icons';\nimport { Col, Form, message, Modal, Row, Space, Typography } from 'antd';\nimport { useForm } from 'antd/lib/form/Form';\nimport { difference, get, omit } from 'lodash';\nimport React, { FC, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport { useHistory, useParams } from 'react-router-dom';\nimport productApi from '../../../api/product-api';\nimport { createStock } from '../../../api/stock-api';\nimport { uploadImagesRequest } from '../../../api/upload-api';\nimport { BackLink, InsaButton, Loading, PageTopWrapper } from '../../../components';\nimport { DefaultLayout } from '../../../layout';\nimport { IProduct, IStock } from '../../../models';\nimport { IState } from '../../../store/rootReducer';\nimport theme from '../../../theme';\nimport { NoProduct, ProductFormDetail, ProductFormMedia } from '../components';\nimport { ProductContextProvider } from '../context/context';\nimport { IProductDetailParams } from '../interface';\nimport ProductFormSaleInfo from '../components/product-form-sale-info';\nimport ProductFormGeneral from './product-form-general';\nimport ProductVariant from './product-variant';\nimport { ProviderProductDetail, useProductDetail } from './state/context';\n\nconst messageSucess = 'Cập nhật sản phẩm thành công';\nconst messageFailed = 'Cập nhật sản phẩm thất bại';\n\nconst ProductDetailContent: FC = () => {\n    const { product, loading, updateProduct, setLoading, loadProduct } = useProductDetail();\n\n    const [filesImage, setFilesImage] = useState<any[]>([]);\n\n    const token = useSelector((state: IState) => state.auth.token);\n    const storeObj = useSelector((state: IState) => state.store.data);\n    const attributes = useSelector((state: IState) => state.store.attributes);\n\n    const params = useParams<IProductDetailParams>();\n    const history = useHistory();\n    const [form] = useForm();\n\n    const handleDeleteProduct = async () => {\n        if (storeObj._id) {\n            await productApi\n                .deleteProduct(storeObj._id, params.productId)\n                .then(() => {\n                    history.push('/products/list');\n\n                    message.success('Xoá sản phẩm thành công');\n                })\n                .catch(() => {\n                    message.error('Xoá sản phẩm thất bại');\n                });\n        } else {\n            message.error('Xoá sản phẩm thất bại');\n        }\n    };\n\n    const confirmDeleteProduct = () => {\n        Modal.confirm({\n            title: 'Xác nhận xoá sản phẩm hiện tại?',\n            icon: <ExclamationCircleOutlined />,\n            onOk: async () => {\n                await handleDeleteProduct();\n            },\n            onCancel() {},\n        });\n    };\n\n    const uploadImages = new Promise(async (resolve, reject) => {\n        if (filesImage.length === 0) {\n            resolve([]);\n            return;\n        }\n\n        const accessToken = get(token, 'accessToken');\n        const files = filesImage.map((i: any) => i.originFileObj);\n\n        uploadImagesRequest({\n            token: accessToken,\n            storeId: storeObj._id as string,\n            files,\n        })\n            .then((res) => resolve(res))\n            .catch((error) => {\n                resolve([]);\n            });\n    });\n\n    const updateImageProduct = (images: string[], type?: 'remove' | 'add') => {\n        let formData = form.getFieldsValue();\n\n        formData = {\n            ...omit(formData, ['sku']),\n        };\n\n        formData = {\n            ...formData,\n            images: [...images],\n        };\n\n        productApi\n            .updateProduct(storeObj._id as string, params.productId, formData)\n            .then((response: IProduct) => {\n                message.success(\n                    type === 'remove' ? 'Đã xóa hình ảnh' : 'Cập nhật hình ảnh thành công'\n                );\n\n                updateProduct(response);\n            })\n            .catch(() => {\n                message.error('Lỗi cập nhật hình ảnh');\n            })\n            .finally(() => {});\n    };\n\n    const updateDataProduct = (formData: any, callback?: () => void) => {\n        productApi\n            .updateProduct(storeObj._id as string, params.productId, formData)\n            .then(async (response: IProduct) => {\n                message.success(messageSucess);\n                if (callback) {\n                    callback();\n                }\n                setFilesImage([]);\n\n                let stocks = form.getFieldValue('stocks');\n\n                if (stocks && stocks.length) {\n                    stocks = stocks.filter((item: IStock) => item.quantity);\n\n                    await Promise.all(\n                        stocks.map((stock: IStock) => {\n                            let { quantity, warehouseId, productId } = stock;\n\n                            return createStock({\n                                storeId: storeObj._id as string,\n                                warehouseId,\n                                quantity,\n                                productId: productId._id as string,\n                            });\n                        })\n                    );\n                    await loadProduct({\n                        productId: product?._id,\n                        storeId: storeObj._id,\n                    });\n                } else {\n                    updateProduct(response);\n                }\n            })\n            .catch(() => {\n                message.error(messageFailed);\n            })\n            .finally(() => {\n                setLoading(false);\n            });\n    };\n\n    const handleCreateAttribute = async () => {\n        const formAttributes = form.getFieldValue('attributes');\n\n        if (formAttributes) {\n            const newAttributes = difference(\n                formAttributes.map((i: any) => i._id),\n                attributes.data.map((i: any) => i._id)\n            );\n\n            if (newAttributes.length) {\n                await Promise.all(\n                    newAttributes.map((attributeId: string) => {\n                        let attributeItem = formAttributes.filter(\n                            (item: any) => item._id === attributeId\n                        )[0];\n                        return productApi.createAttribute(storeObj._id as string, attributeItem);\n                    })\n                );\n            }\n        }\n    };\n\n    const handleUpdateProduct = () => {\n        if (storeObj._id) {\n            setLoading(true);\n            let formData = form.getFieldsValue();\n\n            formData = {\n                ...omit(formData, ['sku']),\n            };\n\n            uploadImages\n                .then(async (response) => {\n                    await handleCreateAttribute();\n\n                    let variantsParam = formData.variants\n                        ? formData.variants.map((item: any) => ({\n                              ...omit(item, [\n                                  'name',\n                                  'length',\n                                  'width',\n                                  'height',\n                                  'weight',\n                                  'localId',\n                              ]),\n                          }))\n                        : undefined;\n\n                    const images = (response as any[]).map((item: any) => item.key);\n                    const productImages = product?.images || [];\n\n                    formData = {\n                        ...formData,\n                        images: [...productImages, ...images],\n                        variants: variantsParam,\n                    };\n\n                    updateDataProduct(formData, () => setFilesImage([]));\n                })\n                .catch((error) => {\n                    updateDataProduct(formData);\n                });\n        } else {\n            message.error('Cập nhật sản phẩm thất bại');\n        }\n    };\n\n    if (loading) return <Loading />;\n\n    if (!product || product.isDeleted) {\n        return <NoProduct />;\n    }\n\n    return (\n        <DefaultLayout title={product.name}>\n            <PageTopWrapper\n                leftContent={\n                    <>\n                        <BackLink to={`/products/list${history.location.state || ''}`} text=\" Danh sách sản phẩm\" />\n                        <Typography.Title level={3}>{product.name}</Typography.Title>\n                    </>\n                }\n                // TODO: Show after add feature\n                // rightContent={\n                //     <Space>\n                //         <InsaButton\n                //             style={{ width: 140 }}\n                //             size=\"middle\"\n                //             key=\"help\"\n                //             disabled={loading}\n                //             icon={<QuestionCircleOutlined />}\n                //         >\n                //             Trợ giúp\n                //         </InsaButton>\n                //     </Space>\n                // }\n            />\n            <Form\n                layout=\"vertical\"\n                className=\"edit-product-form product-form\"\n                size=\"small\"\n                form={form}\n                initialValues={product || {}}\n                onFinish={updateProduct}\n            >\n                <Row\n                    gutter={[16, 0]}\n                    style={{\n                        paddingLeft: theme.spacing.m,\n                        paddingRight: theme.spacing.m,\n                        marginTop: 28,\n                    }}\n                >\n                    <Col span={16}>\n                        <ProductFormGeneral form={form} />\n                        <ProductFormSaleInfo />\n                        <ProductContextProvider form={form}>\n                            <ProductVariant form={form} />\n                        </ProductContextProvider>\n                    </Col>\n                    <Col span={8}>\n                        <ProductFormMedia\n                            images={product.images}\n                            setFilesImage={setFilesImage}\n                            updateImageProduct={updateImageProduct}\n                        />\n                        <ProductFormDetail form={form} />\n                    </Col>\n                </Row>\n\n                <Row\n                    justify=\"end\"\n                    style={{\n                        marginTop: 32,\n                        paddingRight: theme.spacing.m,\n                        paddingBottom: 72,\n                    }}\n                >\n                    <Space>\n                        <InsaButton\n                            style={{ width: 140 }}\n                            size=\"middle\"\n                            key=\"help\"\n                            disabled={loading}\n                            type=\"primary\"\n                            danger\n                            onClick={confirmDeleteProduct}\n                        >\n                            Xoá sản phẩm\n                        </InsaButton>\n                        <InsaButton\n                            style={{ width: 140 }}\n                            size=\"middle\"\n                            key=\"help\"\n                            disabled={loading}\n                            type=\"primary\"\n                            htmlType=\"submit\"\n                            onClick={handleUpdateProduct}\n                        >\n                            Cập nhật\n                        </InsaButton>\n                    </Space>\n                </Row>\n            </Form>\n        </DefaultLayout>\n    );\n};\n\nconst ProductDetail = () => {\n    return (\n        <ProviderProductDetail>\n            <ProductDetailContent />\n        </ProviderProductDetail>\n    );\n};\n\nexport default ProductDetail;\n"]},"metadata":{},"sourceType":"module"}