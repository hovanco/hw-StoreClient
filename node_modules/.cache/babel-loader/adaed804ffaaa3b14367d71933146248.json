{"ast":null,"code":"var _jsxFileName = \"/Users/mac3/Desktop/workspace/StoreClient/src/pages/order/detail/components/btn-send-shipping/index.tsx\",\n    _s = $RefreshSig$();\n\nimport { ExclamationCircleOutlined } from '@ant-design/icons';\nimport { Button, message, Modal } from 'antd';\nimport { get, isNull } from 'lodash';\nimport React, { useEffect, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport shippingApi from '../../../../../api/shipping-api';\nimport { useOrderNew } from '../../../create/state/context';\nimport { useOrderDetail } from '../../state';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst BtnSendShipping = () => {\n  _s();\n\n  var _order$customer, _order$products;\n\n  const [loading, setLoading] = useState(false);\n  const store = useSelector(state => state.store.data);\n  const {\n    order,\n    updateOrder\n  } = useOrderNew();\n  const {\n    isCancel,\n    loadOrder,\n    toggleUpdateSendShip\n  } = useOrderDetail();\n  useEffect(() => {\n    if (order) {\n      toggleUpdateSendShip(!!order.deliveryOptions.shipmentOrderId);\n    }\n  }, [order]);\n  if (!order) return null;\n  const serviceId = get(order, 'deliveryOptions.serviceId');\n  if (isNull(serviceId) || typeof serviceId === 'undefined' || serviceId === 0) return null;\n  if (order.status === 4) return null;\n  const title = isCancel ? 'Hủy vận chuyển' : 'Gửi vận chuyển';\n  const content = isCancel ? 'Hủy đơn hàng vận chuyển' : 'Gửi đơn hàng cho vận chuyển';\n  const message_text = {\n    success: `Đã ${isCancel ? 'hủy' : 'gửi'} cho vận chuyển`,\n    error: `Lỗi  ${isCancel ? 'hủy' : 'gửi'} cho vận chuyển`\n  };\n\n  const handleToggleOrderShip = async () => {\n    // toggleUpdateSendShip(!isCancel);\n    try {\n      setLoading(true);\n      const orderNew = await shippingApi.toggleCreateOrderShip({\n        storeId: store._id,\n        orderId: order._id,\n        cancel: isCancel,\n        warehouseId: order.warehouseId._id\n      });\n      message.success(message_text.success);\n      toggleUpdateSendShip(!isCancel);\n      updateOrder(orderNew);\n      loadOrder(order._id);\n    } catch (error) {\n      message.error(message_text.error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const sendShipping = () => {\n    const totalWeight = order.products.reduce((value, o) => o.productId.weight * o.count + value, 0);\n    let minWeight = order.deliveryOptions.serviceId === 1 ? 10 : 1;\n    let maxWeight = order.deliveryOptions.serviceId === 1 ? 20000 : 1600000;\n\n    if (totalWeight < minWeight) {\n      message.error(`Tổng khối lượng của sản phẩm chưa đạt mức tối thiểu ${minWeight}g`);\n      return;\n    } else if (totalWeight > maxWeight) {\n      message.error(`Tổng khối lượng của sản phẩm vượt mức tối đa ${maxWeight / 1000}kg`);\n      return;\n    }\n\n    Modal.confirm({\n      title,\n      icon: /*#__PURE__*/_jsxDEV(ExclamationCircleOutlined, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 19\n      }, this),\n      content,\n      okText: isCancel ? 'Hủy đơn vận chuyển' : 'Gửi vận chuyển',\n      cancelText: 'Thoát',\n      onOk: () => {\n        handleToggleOrderShip();\n      },\n      onCancel: () => {}\n    });\n  };\n\n  const disabled = order && (!((_order$customer = order.customer) === null || _order$customer === void 0 ? void 0 : _order$customer.name) || !order.customer.phoneNo || !order.customer.address || !order.customer.province || !order.customer.district || !order.customer.ward || ((_order$products = order.products) === null || _order$products === void 0 ? void 0 : _order$products.length) === 0);\n  return /*#__PURE__*/_jsxDEV(Button, {\n    disabled: disabled,\n    onClick: sendShipping,\n    type: \"primary\",\n    danger: isCancel,\n    loading: loading,\n    children: title\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 104,\n    columnNumber: 9\n  }, this);\n};\n\n_s(BtnSendShipping, \"R0g2elym+z5VNanTVqJtHROzncs=\", false, function () {\n  return [useSelector, useOrderNew, useOrderDetail];\n});\n\n_c = BtnSendShipping;\nexport default BtnSendShipping;\n\nvar _c;\n\n$RefreshReg$(_c, \"BtnSendShipping\");","map":{"version":3,"sources":["/Users/mac3/Desktop/workspace/StoreClient/src/pages/order/detail/components/btn-send-shipping/index.tsx"],"names":["ExclamationCircleOutlined","Button","message","Modal","get","isNull","React","useEffect","useState","useSelector","shippingApi","useOrderNew","useOrderDetail","BtnSendShipping","loading","setLoading","store","state","data","order","updateOrder","isCancel","loadOrder","toggleUpdateSendShip","deliveryOptions","shipmentOrderId","serviceId","status","title","content","message_text","success","error","handleToggleOrderShip","orderNew","toggleCreateOrderShip","storeId","_id","orderId","cancel","warehouseId","sendShipping","totalWeight","products","reduce","value","o","productId","weight","count","minWeight","maxWeight","confirm","icon","okText","cancelText","onOk","onCancel","disabled","customer","name","phoneNo","address","province","district","ward","length"],"mappings":"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","sourcesContent":["import { ExclamationCircleOutlined } from '@ant-design/icons';\nimport { Button, message, Modal } from 'antd';\nimport { get, isNull } from 'lodash';\nimport React, { useEffect, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport shippingApi from '../../../../../api/shipping-api';\nimport { IWarehouse } from '../../../../../models';\nimport { IState } from '../../../../../store/rootReducer';\nimport { useOrderNew } from '../../../create/state/context';\nimport { useOrderDetail } from '../../state';\n\nconst BtnSendShipping = () => {\n    const [loading, setLoading] = useState<boolean>(false);\n    const store = useSelector((state: IState) => state.store.data);\n    const { order, updateOrder } = useOrderNew();\n    const { isCancel, loadOrder, toggleUpdateSendShip } = useOrderDetail();\n\n    useEffect(() => {\n        if (order) {\n            toggleUpdateSendShip(!!order.deliveryOptions.shipmentOrderId);\n        }\n    }, [order]);\n\n    if (!order) return null;\n\n    const serviceId = get(order, 'deliveryOptions.serviceId');\n\n    if (isNull(serviceId) || typeof serviceId === 'undefined' || serviceId === 0) return null;\n\n    if (order.status === 4) return null;\n\n    const title = isCancel ? 'Hủy vận chuyển' : 'Gửi vận chuyển';\n\n    const content = isCancel ? 'Hủy đơn hàng vận chuyển' : 'Gửi đơn hàng cho vận chuyển';\n\n    const message_text = {\n        success: `Đã ${isCancel ? 'hủy' : 'gửi'} cho vận chuyển`,\n        error: `Lỗi  ${isCancel ? 'hủy' : 'gửi'} cho vận chuyển`,\n    };\n\n    const handleToggleOrderShip = async () => {\n        // toggleUpdateSendShip(!isCancel);\n        try {\n            setLoading(true);\n            const orderNew = await shippingApi.toggleCreateOrderShip({\n                storeId: store._id as string,\n                orderId: order._id,\n                cancel: isCancel,\n                warehouseId: (order.warehouseId as IWarehouse)._id,\n            });\n\n            message.success(message_text.success);\n            toggleUpdateSendShip(!isCancel);\n            updateOrder(orderNew);\n            loadOrder(order._id);\n        } catch (error) {\n            message.error(message_text.error);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const sendShipping = () => {\n        const totalWeight = order.products.reduce(\n            (value: number, o: any) => o.productId.weight * o.count + value,\n            0,\n        );\n\n        let minWeight = order.deliveryOptions.serviceId === 1 ? 10 : 1;\n        let maxWeight = order.deliveryOptions.serviceId === 1 ? 20000 : 1600000;\n\n        if (totalWeight < minWeight) {\n            message.error(`Tổng khối lượng của sản phẩm chưa đạt mức tối thiểu ${minWeight}g`);\n            return;\n        } else if (totalWeight > maxWeight) {\n            message.error(`Tổng khối lượng của sản phẩm vượt mức tối đa ${maxWeight / 1000}kg`);\n            return;\n        }\n\n        Modal.confirm({\n            title,\n            icon: <ExclamationCircleOutlined />,\n            content,\n            okText: isCancel ? 'Hủy đơn vận chuyển' : 'Gửi vận chuyển',\n            cancelText: 'Thoát',\n            onOk: () => {\n                handleToggleOrderShip();\n            },\n            onCancel: () => {},\n        });\n    };\n\n    const disabled =\n        order &&\n        (!order.customer?.name ||\n            !order.customer.phoneNo ||\n            !order.customer.address ||\n            !order.customer.province ||\n            !order.customer.district ||\n            !order.customer.ward ||\n            order.products?.length === 0);\n\n    return (\n        <Button\n            disabled={disabled}\n            onClick={sendShipping}\n            type='primary'\n            danger={isCancel}\n            loading={loading}\n        >\n            {title}\n        </Button>\n    );\n};\n\nexport default BtnSendShipping;\n"]},"metadata":{},"sourceType":"module"}